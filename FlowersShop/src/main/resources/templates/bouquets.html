<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bouquets</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" th:href="@{/css/products.css}">

</head>

<body>

<div id="cartNotification" class="cart-notification">
    Product added to cart!
</div>

<header>
    <div class="top-bar">
        <div class="delivery">Home delivery available in Romania | Free returns</div>
        <div class="user">
               <span th:if="${isAuthenticated == true and fullName != null and role != 'admin'}">
                Welcome, <span th:text="${fullName}"></span>!
                <a th:href="@{/auth/logout}" class="logout-link">Logout</a> |
<a th:href="@{/cart/}" class="cart-link">Cart <span id="cartCounter" class="cart-counter">0</span></a>
            </span>
            <span th:if="${isAuthenticated == true and fullName != null and role == 'admin'}">
                Welcome, <span th:text="${fullName}"></span>!
                <a th:href="@{/auth/logout}" class="logout-link">Logout</a> |
                <a th:href="@{/admin/dashboard}" class="dashboard-link">Dashboard</a>
            </span>
            <span th:if="${isAuthenticated == false or isAuthenticated == null}">
                <a th:href="@{/auth/login}">Log in</a> |
                <a th:href="@{/auth/register}">Register</a> |
                <a th:href="@{/cart}" class="cart-link">Cart</a>
            </span>
        </div>
    </div>
    <div class="logo">Peony Bloom</div>
</header>

<main>
    <nav>
        <div class="category">
            <a th:href="@{/home}">About us</a>
        </div>
        <div class="category">
            <a th:href="@{/product/bouquets}">Bouquets</a>
        </div>
        <div class="category">
            <a th:href="@{/main/plants}">Plants</a>
        </div>
        <div class="category">
            <a th:href="@{/main/gifts}">Gifts</a>
        </div>
        <div class="category">
            <a th:href="@{contact}">Contact</a>
        </div>
    </nav>

    <div class="intro">
        <h1 class="titlePage">Bouquets</h1>
        <div class="intro-text">
            Made with passion in our atelier, our fresh flower bouquets are crafted with expertise derived from the
            century-old “Lachaume Techniques”. Each creation is meticulously designed as an immersion into our floral
            universe. Timeless, elegant and refined style that reflects our heritage.
            From stunning chrysanthemum and roses to vibrant seasonal bouquets, our range of beautiful blooms are
            perfect for brightening the home and celebrating life’s special moments. Whatever the occasion, say it with
            flowers, all with free nominated day delivery. Discover our wide selection of gorgeous bouquets today.
        </div>
    </div>


    <section class="bouquets-section">
        <div class="product-form">
            <div class="product-card"  th:each="product : ${allProducts}"
                 th:if="${product.category != null and product.category.toString().equalsIgnoreCase('bouquet')}">
                <a th:href="@{'/product/info/' + ${product.id}}" style="text-decoration: none; color: inherit;">
                <div class="img">
                <img th:src="@{${product.image}}" alt="image">
            </div>
            <div class="price">
                <div th:text="${product.name}"></div>
                <div th:text="${product.price+' $'}"></div>
            </div>
                </a>

                <button type="button" class="btn btn-primary add-to-cart-btn"
                        th:data-product-id="${product.id}"
                        th:data-product-name="${product.name}"
                        th:data-product-price="${product.price}">
                    ADD TO CART
                </button>
            </div>
        </div>
    </section>
</main>

    <script>
        // Функции для работы с корзиной
        function getCart() {
            return JSON.parse(localStorage.getItem('cart') || '[]');
        }

        function saveCart(cart) {
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCounter();
        }

        function addToCart(productId, productName, productPrice) {
            let cart = getCart();

            // Проверяем, есть ли уже такой товар в корзине
            const existingItem = cart.find(item => item.productId === productId);

            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    productId: productId,
                    name: productName,
                    price: productPrice,
                    quantity: 1
                });
            }

            saveCart(cart);
            showNotification('Product added to cart!');
        }

        function updateCartCounter() {
            const cart = getCart();
            const counter = document.getElementById('cartCounter');
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);

            if (totalItems > 0) {
                counter.textContent = totalItems;
                counter.style.display = 'inline';
            } else {
                counter.style.display = 'none';
            }
        }

        function showNotification(message) {
            const notification = document.getElementById('cartNotification');
            notification.textContent = message;
            notification.style.display = 'block';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        function goToCart() {
            window.location.href = '/cart/';
        }

        // Инициализация при загрузке страницы
        document.addEventListener('DOMContentLoaded', function() {
            updateCartCounter();

            // Добавляем обработчики событий для всех кнопок "ADD TO CART"
            const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
            addToCartButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const productId = parseInt(this.getAttribute('data-product-id'));
                    const productName = this.getAttribute('data-product-name');
                    const productPrice = parseFloat(this.getAttribute('data-product-price'));

                    addToCart(productId, productName, productPrice);
                });
            });
        });
    </script>

<footer class="footer">
    Copyright © PEONY GROUP
</footer>

</body>
</html>



<!--  <div class="modal fade" id="purchaseModal" tabindex="-1" aria-hidden="true">
                      <div class="modal-dialog">
                          <div class="modal-content">
                              <div class="modal-header">
                                  <h5 class="modal-title">Great choice!</h5>
                                  <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                              </div>
                              <div class="modal-body">
                                  The item was purchased successfully!
                              </div>
                              <div class="modal-footer">
                                  <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                              </div>
                          </div>
                      </div>
                  </div>
<script>
                      document.getElementById('purchaseForm').addEventListener('submit', function(e) {
                          const quantity = document.getElementById('quantityInput').value;
                          if (quantity <= 0) {
                              e.preventDefault();
                              alert('Quantity must be greater than 0');
                              return false;
                          }

                      });
                  </script>
-->


<!--   <form action="/sale/purchase" method="post" class="purchaseForm">
       <input type="hidden" name="productId" th:value="${product.id}">
       <input type="hidden" name="quantity" value="1">
       <button type="submit" class="btn btn-primary">ADD TO CART</button>
   </form>
   <div th:if="${sale != null}">
       <p>Purchase successful! Sale ID: <span th:text="${sale.id}"></span></p>
   </div>
   -->